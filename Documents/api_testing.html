<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supermarket API Complete Test Client</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .auth-section {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .auth-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .user-badge {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: #e9ecef;
            border: none;
            font-size: 14px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: #dee2e6;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .section h3 {
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        }

        .response {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #667eea;
            max-height: 400px;
            overflow-y: auto;
        }

        .response pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .item-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            background: white;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .item-card h3, .item-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .item-card p {
            margin: 5px 0;
            color: #6c757d;
            font-size: 13px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 5px;
        }

        .badge-featured {
            background: #ffc107;
            color: #000;
        }

        .badge-stock {
            background: #28a745;
            color: white;
        }

        .badge-out {
            background: #dc3545;
            color: white;
        }

        .badge-active {
            background: #28a745;
            color: white;
        }

        .badge-inactive {
            background: #6c757d;
            color: white;
        }

        .price {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .compare-price {
            text-decoration: line-through;
            color: #6c757d;
            font-size: 14px;
            margin-right: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .button-group button {
            margin: 0;
            font-size: 12px;
            padding: 6px 12px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .items-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõí Supermarket API Test Client</h1>
            <p>Complete CRUD Operations for All Models</p>
        </div>

        <div class="auth-section">
            <div class="auth-info">
                <div id="userInfo">
                    <span>Not logged in</span>
                </div>
                <div>
                    <input type="text" id="apiBaseUrl" placeholder="API Base URL" value="http://localhost:5000/api" style="width: 300px; display: inline-block; margin-right: 10px;">
                    <button onclick="logout()" class="btn-danger">Logout</button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('auth')">üîê Auth</button>
            <button class="tab" onclick="showTab('users')">üë§ Users</button>
            <button class="tab" onclick="showTab('customers')">üë• Customers</button>
            <button class="tab" onclick="showTab('categories')">üìÅ Categories</button>
            <button class="tab" onclick="showTab('products')">üì¶ Products</button>
            <button class="tab" onclick="showTab('cart')">üõí Cart</button>
            <button class="tab" onclick="showTab('orders')">üìã Orders</button>
        </div>

        <!-- Auth Tab -->
        <div id="auth" class="tab-content active">
            <div class="section">
                <h3>Register</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="user@example.com">
                    </div>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="regUsername" placeholder="username">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="password">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select id="regRole">
                            <option value="customer">Customer</option>
                            <option value="admin">Admin</option>
                            <option value="manager">Manager</option>
                            <option value="cashier">Cashier</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="regFirstName" placeholder="John">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="regLastName" placeholder="Doe">
                    </div>
                </div>
                <button onclick="register()">Register</button>
                <div id="regResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Login</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email or Username</label>
                        <input type="text" id="loginEmail" placeholder="email or username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="password">
                    </div>
                </div>
                <button onclick="login()">Login</button>
                <div id="loginResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Current User</h3>
                <button onclick="getCurrentUser()">Get My Info</button>
                <div id="currentUserResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Change Password</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Old Password</label>
                        <input type="password" id="oldPassword">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="newPassword">
                    </div>
                </div>
                <button onclick="changePassword()">Change Password</button>
                <div id="changePasswordResponse" class="response" style="display: none;"></div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users" class="tab-content">
            <div class="section">
                <h3>Get All Users (Admin Only)</h3>
                <button onclick="getAllUsers()">Get All Users</button>
                <div id="usersListContainer"></div>
                <div id="usersResponse" class="response" style="display: none;"></div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <div class="section">
                <h3>Get All Customers (Admin Only)</h3>
                <button onclick="getAllCustomers()">Get All Customers</button>
                <div id="customersListContainer"></div>
                <div id="customersResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Update Customer Profile</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="custFirstName">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="custLastName">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="text" id="custPhone">
                    </div>
                    <div class="form-group">
                        <label>Address Line 1</label>
                        <input type="text" id="custAddress1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" id="custCity">
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <input type="text" id="custState">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Postal Code</label>
                        <input type="text" id="custPostal">
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <input type="text" id="custCountry">
                    </div>
                </div>
                <button onclick="updateCustomerProfile()">Update Profile</button>
                <div id="updateCustomerResponse" class="response" style="display: none;"></div>
            </div>
        </div>

        <!-- Categories Tab -->
        <div id="categories" class="tab-content">
            <div class="section">
                <h3>Create Category (Admin Only)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="catName" placeholder="Electronics">
                    </div>
                    <div class="form-group">
                        <label>Parent Category</label>
                        <select id="catParent">
                            <option value="">None (Top Level)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="catDescription" placeholder="Category description"></textarea>
                </div>
                <button onclick="createCategory()">Create Category</button>
                <div id="createCategoryResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Categories List</h3>
                <button onclick="getCategories()">Get All Categories</button>
                <button onclick="loadCategoryDropdowns()">Refresh Dropdowns</button>
                <div id="categoriesListContainer"></div>
                <div id="categoriesResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Update Category (Admin Only)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Select Category</label>
                        <select id="updateCatSelect"></select>
                    </div>
                    <div class="form-group">
                        <label>New Name</label>
                        <input type="text" id="updateCatName">
                    </div>
                </div>
                <div class="form-group">
                    <label>New Description</label>
                    <textarea id="updateCatDescription"></textarea>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="updateCatActive">
                        <option value="true">Active</option>
                        <option value="false">Inactive</option>
                    </select>
                </div>
                <button onclick="updateCategory()">Update Category</button>
                <div id="updateCategoryResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Delete Category (Admin Only)</h3>
                <div class="form-group">
                    <label>Select Category to Delete</label>
                    <select id="deleteCatSelect"></select>
                </div>
                <button onclick="deleteCategory()" class="btn-danger">Delete Category</button>
                <div id="deleteCategoryResponse" class="response" style="display: none;"></div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div class="section">
                <h3>Create Product (Admin Only)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="prodName" placeholder="Product Name">
                    </div>
                    <div class="form-group">
                        <label>SKU</label>
                        <input type="text" id="prodSku" placeholder="SKU-12345">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Price</label>
                        <input type="number" id="prodPrice" step="0.01" placeholder="29.99">
                    </div>
                    <div class="form-group">
                        <label>Compare Price (optional)</label>
                        <input type="number" id="prodComparePrice" step="0.01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="prodCategory"></select>
                    </div>
                    <div class="form-group">
                        <label>Stock Quantity</label>
                        <input type="number" id="prodStock" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="prodDescription"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="text" id="prodImageUrl" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="prodWeight" step="0.01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Dimensions</label>
                        <input type="text" id="prodDimensions" placeholder="10x20x30 cm">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="prodFeatured"> Featured Product
                        </label>
                        <label>
                            <input type="checkbox" id="prodActive" checked> Active
                        </label>
                    </div>
                </div>
                <button onclick="createProduct()">Create Product</button>
                <div id="createProductResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Products List</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Search</label>
                        <input type="text" id="searchQuery" placeholder="Search products...">
                    </div>
                    <div class="form-group">
                        <label>Filter by Category</label>
                        <select id="filterCategory">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                </div>
                <button onclick="getProducts()">Get All Products</button>
                <button onclick="searchProducts()">Search</button>
                <button onclick="getFeaturedProducts()">Get Featured</button>
                <button onclick="loadProductDropdowns()">Refresh Dropdowns</button>
                <div id="productsListContainer"></div>
                <div id="productsResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Update Product (Admin Only)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Select Product</label>
                        <select id="updateProdSelect" onchange="loadProductForUpdate()"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="updateProdName">
                    </div>
                    <div class="form-group">
                        <label>Price</label>
                        <input type="number" id="updateProdPrice" step="0.01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Stock Quantity</label>
                        <input type="number" id="updateProdStock">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="updateProdActive">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </div>
                <button onclick="updateProduct()">Update Product</button>
                <div id="updateProductResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Delete Product (Admin Only)</h3>
                <div class="form-group">
                    <label>Select Product to Delete</label>
                    <select id="deleteProdSelect"></select>
                </div>
                <button onclick="deleteProduct()" class="btn-danger">Delete Product</button>
                <div id="deleteProductResponse" class="response" style="display: none;"></div>
            </div>
        </div>

        <!-- Cart Tab -->
        <div id="cart" class="tab-content">
            <div class="section">
                <h3>My Cart</h3>
                <button onclick="getCart()">Get Cart</button>
                <button onclick="clearCart()" class="btn-danger">Clear Cart</button>
                <div id="cartDetails"></div>
                <div id="cartResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Add to Cart</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Select Product</label>
                        <select id="cartProductSelect"></select>
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="cartQuantity" value="1" min="1">
                    </div>
                </div>
                <button onclick="addToCartFromSelect()">Add to Cart</button>
            </div>

            <div class="section">
                <h3>Update Cart Item</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Product ID</label>
                        <input type="number" id="updateCartProductId">
                    </div>
                    <div class="form-group">
                        <label>New Quantity</label>
                        <input type="number" id="updateCartQuantity" min="1">
                    </div>
                </div>
                <button onclick="updateCartItem()">Update Quantity</button>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="orders" class="tab-content">
            <div class="section">
                <h3>My Orders</h3>
                <button onclick="getOrders()">Get My Orders</button>
                <div id="ordersListContainer"></div>
                <div id="ordersResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Create Order from Cart</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Address Line 1</label>
                        <input type="text" id="orderAddress1" placeholder="123 Main St">
                    </div>
                    <div class="form-group">
                        <label>Address Line 2</label>
                        <input type="text" id="orderAddress2" placeholder="Apt 4">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" id="orderCity" placeholder="New York">
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <input type="text" id="orderState" placeholder="NY">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Postal Code</label>
                        <input type="text" id="orderPostal" placeholder="10001">
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <input type="text" id="orderCountry" placeholder="USA">
                    </div>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select id="orderPaymentMethod">
                        <option value="credit_card">Credit Card</option>
                        <option value="debit_card">Debit Card</option>
                        <option value="paypal">PayPal</option>
                        <option value="cash">Cash on Delivery</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Customer Notes</label>
                    <textarea id="orderNotes" placeholder="Special delivery instructions..."></textarea>
                </div>
                <button onclick="createOrder()">Create Order</button>
            </div>

            <div class="section">
                <h3>Get Order Details</h3>
                <div class="form-group">
                    <label>Order ID</label>
                    <input type="number" id="getOrderId">
                </div>
                <button onclick="getOrderDetails()">Get Order</button>
                <div id="orderDetailsContainer"></div>
            </div>

            <div class="section">
                <h3>Admin: All Orders</h3>
                <div class="form-group">
                    <label>Filter by Status</label>
                    <select id="adminOrderStatus">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="processing">Processing</option>
                        <option value="shipped">Shipped</option>
                        <option value="delivered">Delivered</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="refunded">Refunded</option>
                    </select>
                </div>
                <button onclick="getAllOrders()">Get All Orders (Admin)</button>
                <div id="adminOrdersContainer"></div>
            </div>

            <div class="section">
                <h3>Admin: Update Order Status</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Order ID</label>
                        <input type="number" id="updateOrderId">
                    </div>
                    <div class="form-group">
                        <label>New Status</label>
                        <select id="updateOrderStatus">
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="processing">Processing</option>
                            <option value="shipped">Shipped</option>
                            <option value="delivered">Delivered</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="refunded">Refunded</option>
                        </select>
                    </div>
                </div>
                <button onclick="updateOrderStatus()">Update Status</button>
                <div id="updateOrderResponse" class="response" style="display: none;"></div>
            </div>

            <div class="section">
                <h3>Admin: Update Payment Status</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Order ID</label>
                        <input type="number" id="updatePaymentOrderId">
                    </div>
                    <div class="form-group">
                        <label>Payment Status</label>
                        <select id="updatePaymentStatus">
                            <option value="pending">Pending</option>
                            <option value="paid">Paid</option>
                            <option value="failed">Failed</option>
                            <option value="refunded">Refunded</option>
                        </select>
                    </div>
                </div>
                <button onclick="updatePaymentStatus()">Update Payment Status</button>
                <div id="updatePaymentResponse" class="response" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let token = localStorage.getItem('token');
        let currentUser = null;
        let categories = [];
        let products = [];

        // Helper functions
        function getApiUrl() {
            return document.getElementById('apiBaseUrl').value;
        }

        async function apiCall(endpoint, method = 'GET', body = null, requireAuth = false) {
            const url = getApiUrl() + endpoint;
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            if (requireAuth && token) {
                options.headers['Authorization'] = `Bearer ${token}`;
            }

            if (body) {
                options.body = JSON.stringify(body);
            }

            const response = await fetch(url, options);
            const data = await response.json();

            if (!response.ok) {
                throw data;
            }

            return data;
        }

        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = isError ? 'response error' : 'response success';
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (currentUser) {
                userInfo.innerHTML = `
                    <div class="user-badge">
                        ${currentUser.username} (${currentUser.role})
                    </div>
                `;
            } else {
                userInfo.innerHTML = '<span>Not logged in</span>';
            }
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            // Load data when switching to certain tabs
            if (tabName === 'categories') {
                loadCategoryDropdowns();
            } else if (tabName === 'products') {
                loadProductDropdowns();
            } else if (tabName === 'cart') {
                loadProductDropdowns();
            }
        }

        // Auth functions
        async function register() {
            try {
                const data = await apiCall('/auth/register', 'POST', {
                    email: document.getElementById('regEmail').value,
                    username: document.getElementById('regUsername').value,
                    password: document.getElementById('regPassword').value,
                    role: document.getElementById('regRole').value,
                    first_name: document.getElementById('regFirstName').value,
                    last_name: document.getElementById('regLastName').value
                });
                showResponse('regResponse', data);
            } catch (error) {
                showResponse('regResponse', error, true);
            }
        }

        async function login() {
            try {
                const data = await apiCall('/auth/login', 'POST', {
                    email_or_username: document.getElementById('loginEmail').value,
                    password: document.getElementById('loginPassword').value
                });
                
                token = data.access_token;
                currentUser = data.user;
                localStorage.setItem('token', token);
                localStorage.setItem('user', JSON.stringify(currentUser));
                
                updateUserInfo();
                showResponse('loginResponse', data);
            } catch (error) {
                showResponse('loginResponse', error, true);
            }
        }

        function logout() {
            token = null;
            currentUser = null;
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            updateUserInfo();
            alert('Logged out successfully');
        }

        async function getCurrentUser() {
            try {
                const data = await apiCall('/auth/me', 'GET', null, true);
                showResponse('currentUserResponse', data);
            } catch (error) {
                showResponse('currentUserResponse', error, true);
            }
        }

        async function changePassword() {
            try {
                const data = await apiCall('/auth/change-password', 'POST', {
                    old_password: document.getElementById('oldPassword').value,
                    new_password: document.getElementById('newPassword').value
                }, true);
                showResponse('changePasswordResponse', data);
            } catch (error) {
                showResponse('changePasswordResponse', error, true);
            }
        }

        // Users functions
        async function getAllUsers() {
            try {
                const data = await apiCall('/users', 'GET', null, true);
                showResponse('usersResponse', data);
                displayUsers(data.users || []);
            } catch (error) {
                showResponse('usersResponse', error, true);
            }
        }

        function displayUsers(users) {
            const container = document.getElementById('usersListContainer');
            if (!users || users.length === 0) {
                container.innerHTML = '<p>No users found</p>';
                return;
            }

            container.innerHTML = '<div class="items-grid">' + users.map(u => `
                <div class="item-card">
                    <h4>${u.username}</h4>
                    <p><strong>Email:</strong> ${u.email}</p>
                    <p><strong>Role:</strong> <span class="badge">${u.role}</span></p>
                    <p><strong>Status:</strong> ${u.is_active ? '<span class="badge badge-active">Active</span>' : '<span class="badge badge-inactive">Inactive</span>'}</p>
                    <p><strong>Created:</strong> ${new Date(u.created_at).toLocaleDateString()}</p>
                </div>
            `).join('') + '</div>';
        }

        // Customers functions
        async function getAllCustomers() {
            try {
                const data = await apiCall('/customers', 'GET', null, true);
                showResponse('customersResponse', data);
                displayCustomers(data.customers || []);
            } catch (error) {
                showResponse('customersResponse', error, true);
            }
        }

        function displayCustomers(customers) {
            const container = document.getElementById('customersListContainer');
            if (!customers || customers.length === 0) {
                container.innerHTML = '<p>No customers found</p>';
                return;
            }

            container.innerHTML = '<div class="items-grid">' + customers.map(c => `
                <div class="item-card">
                    <h4>${c.full_name}</h4>
                    <p><strong>Email:</strong> ${c.user?.email || 'N/A'}</p>
                    <p><strong>Phone:</strong> ${c.phone || 'N/A'}</p>
                    <p><strong>City:</strong> ${c.address?.city || 'N/A'}</p>
                    <p><strong>Country:</strong> ${c.address?.country || 'N/A'}</p>
                </div>
            `).join('') + '</div>';
        }

        async function updateCustomerProfile() {
            try {
                const data = await apiCall('/customers/profile', 'PUT', {
                    first_name: document.getElementById('custFirstName').value,
                    last_name: document.getElementById('custLastName').value,
                    phone: document.getElementById('custPhone').value,
                    address_line1: document.getElementById('custAddress1').value,
                    city: document.getElementById('custCity').value,
                    state: document.getElementById('custState').value,
                    postal_code: document.getElementById('custPostal').value,
                    country: document.getElementById('custCountry').value
                }, true);
                showResponse('updateCustomerResponse', data);
            } catch (error) {
                showResponse('updateCustomerResponse', error, true);
            }
        }

        // Categories functions
        async function loadCategoryDropdowns() {
            try {
                const data = await apiCall('/categories');
                categories = data.categories || [];
                
                // Update all category dropdowns
                const selects = ['catParent', 'prodCategory', 'filterCategory', 'updateCatSelect', 'deleteCatSelect'];
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (!select) return;
                    
                    const currentValue = select.value;
                    const includeEmpty = ['catParent', 'filterCategory'].includes(selectId);
                    
                    select.innerHTML = includeEmpty ? '<option value="">None</option>' : '';
                    categories.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat.id;
                        option.textContent = cat.name;
                        select.appendChild(option);
                    });
                    
                    if (currentValue) select.value = currentValue;
                });
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }

        async function getCategories() {
            try {
                const data = await apiCall('/categories');
                showResponse('categoriesResponse', data);
                displayCategories(data.categories);
                categories = data.categories || [];
            } catch (error) {
                showResponse('categoriesResponse', error, true);
            }
        }

        function displayCategories(cats) {
            const container = document.getElementById('categoriesListContainer');
            if (!cats || cats.length === 0) {
                container.innerHTML = '<p>No categories found</p>';
                return;
            }

            container.innerHTML = '<div class="items-grid">' + cats.map(c => `
                <div class="item-card">
                    <h4>${c.name}</h4>
                    <p>${c.description || 'No description'}</p>
                    <p><strong>Products:</strong> ${c.products_count || 0}</p>
                    <p><strong>Status:</strong> ${c.is_active ? '<span class="badge badge-active">Active</span>' : '<span class="badge badge-inactive">Inactive</span>'}</p>
                    <div class="button-group">
                        <button onclick="editCategory(${c.id})" class="btn-warning">Edit</button>
                        <button onclick="deleteCategoryById(${c.id})" class="btn-danger">Delete</button>
                    </div>
                </div>
            `).join('') + '</div>';
        }

        async function createCategory() {
            try {
                const parentId = document.getElementById('catParent').value;
                const data = await apiCall('/categories', 'POST', {
                    name: document.getElementById('catName').value,
                    description: document.getElementById('catDescription').value,
                    parent_id: parentId ? parseInt(parentId) : null,
                    is_active: true
                }, true);
                showResponse('createCategoryResponse', data);
                getCategories();
                loadCategoryDropdowns();
            } catch (error) {
                showResponse('createCategoryResponse', error, true);
            }
        }

        async function updateCategory() {
            try {
                const catId = document.getElementById('updateCatSelect').value;
                if (!catId) {
                    alert('Please select a category');
                    return;
                }
                
                const data = await apiCall(`/categories/${catId}`, 'PUT', {
                    name: document.getElementById('updateCatName').value,
                    description: document.getElementById('updateCatDescription').value,
                    is_active: document.getElementById('updateCatActive').value === 'true'
                }, true);
                showResponse('updateCategoryResponse', data);
                getCategories();
                loadCategoryDropdowns();
            } catch (error) {
                showResponse('updateCategoryResponse', error, true);
            }
        }

        async function deleteCategory() {
            const catId = document.getElementById('deleteCatSelect').value;
            if (!catId) {
                alert('Please select a category');
                return;
            }
            if (!confirm('Are you sure you want to delete this category?')) return;
            
            try {
                const data = await apiCall(`/categories/${catId}`, 'DELETE', null, true);
                showResponse('deleteCategoryResponse', data);
                getCategories();
                loadCategoryDropdowns();
            } catch (error) {
                showResponse('deleteCategoryResponse', error, true);
            }
        }

        async function deleteCategoryById(id) {
            if (!confirm('Are you sure you want to delete this category?')) return;
            
            try {
                const data = await apiCall(`/categories/${id}`, 'DELETE', null, true);
                showResponse('categoriesResponse', data);
                getCategories();
                loadCategoryDropdowns();
            } catch (error) {
                showResponse('categoriesResponse', error, true);
            }
        }

        // Products functions
        async function loadProductDropdowns() {
            try {
                const data = await apiCall('/products?per_page=100');
                products = data.products || [];
                
                const selects = ['cartProductSelect', 'updateProdSelect', 'deleteProdSelect'];
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (!select) return;
                    
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">Select Product</option>';
                    
                    products.forEach(prod => {
                        const option = document.createElement('option');
                        option.value = prod.id;
                        option.textContent = `${prod.name} - $${prod.price} (Stock: ${prod.stock_quantity})`;
                        select.appendChild(option);
                    });
                    
                    if (currentValue) select.value = currentValue;
                });
            } catch (error) {
                console.error('Failed to load products:', error);
            }
        }

        async function getProducts() {
            try {
                const categoryId = document.getElementById('filterCategory')?.value;
                let url = '/products?per_page=50';
                if (categoryId) url += `&category_id=${categoryId}`;
                
                const data = await apiCall(url);
                showResponse('productsResponse', data);
                displayProducts(data.products);
            } catch (error) {
                showResponse('productsResponse', error, true);
            }
        }

        async function getFeaturedProducts() {
            try {
                const data = await apiCall('/products?featured=true');
                showResponse('productsResponse', data);
                displayProducts(data.products);
            } catch (error) {
                showResponse('productsResponse', error, true);
            }
        }

        async function searchProducts() {
            const query = document.getElementById('searchQuery').value;
            if (!query) {
                getProducts();
                return;
            }
            
            try {
                const data = await apiCall(`/products?search=${encodeURIComponent(query)}`);
                showResponse('productsResponse', data);
                displayProducts(data.products);
            } catch (error) {
                showResponse('productsResponse', error, true);
            }
        }

        function displayProducts(prods) {
            const container = document.getElementById('productsListContainer');
            if (!prods || prods.length === 0) {
                container.innerHTML = '<p>No products found</p>';
                return;
            }

            container.innerHTML = '<div class="items-grid">' + prods.map(p => `
                <div class="item-card">
                    <h4>${p.name}</h4>
                    ${p.is_featured ? '<span class="badge badge-featured">‚≠ê Featured</span>' : ''}
                    ${p.is_in_stock ? '<span class="badge badge-stock">In Stock</span>' : '<span class="badge badge-out">Out of Stock</span>'}
                    <div class="price">
                        ${p.compare_price ? `<span class="compare-price">$${p.compare_price}</span>` : ''}
                        $${p.price}
                        ${p.discount_percentage > 0 ? `<span style="color: #dc3545; font-size: 12px;">(${p.discount_percentage}% off)</span>` : ''}
                    </div>
                    <p><strong>SKU:</strong> ${p.sku || 'N/A'}</p>
                    <p><strong>Stock:</strong> ${p.stock_quantity}</p>
                    <p><strong>Category:</strong> ${p.category?.name || 'N/A'}</p>
                    <p>${p.description ? p.description.substring(0, 100) + '...' : ''}</p>
                    <div class="button-group">
                        ${token ? `<button onclick="quickAddToCart(${p.id})" class="btn-success">Add to Cart</button>` : ''}
                        <button onclick="editProduct(${p.id})" class="btn-warning">Edit</button>
                        <button onclick="deleteProductById(${p.id})" class="btn-danger">Delete</button>
                    </div>
                </div>
            `).join('') + '</div>';
        }

        async function createProduct() {
            try {
                const data = await apiCall('/products', 'POST', {
                    name: document.getElementById('prodName').value,
                    sku: document.getElementById('prodSku').value,
                    price: parseFloat(document.getElementById('prodPrice').value),
                    compare_price: document.getElementById('prodComparePrice').value ? parseFloat(document.getElementById('prodComparePrice').value) : null,
                    category_id: parseInt(document.getElementById('prodCategory').value),
                    stock_quantity: parseInt(document.getElementById('prodStock').value) || 0,
                    description: document.getElementById('prodDescription').value,
                    image_url: document.getElementById('prodImageUrl').value,
                    weight: document.getElementById('prodWeight').value ? parseFloat(document.getElementById('prodWeight').value) : null,
                    dimensions: document.getElementById('prodDimensions').value,
                    is_featured: document.getElementById('prodFeatured').checked,
                    is_active: document.getElementById('prodActive').checked
                }, true);
                showResponse('createProductResponse', data);
                getProducts();
                loadProductDropdowns();
            } catch (error) {
                showResponse('createProductResponse', error, true);
            }
        }

        async function loadProductForUpdate() {
            const prodId = document.getElementById('updateProdSelect').value;
            if (!prodId) return;
            
            const product = products.find(p => p.id == prodId);
            if (product) {
                document.getElementById('updateProdName').value = product.name;
                document.getElementById('updateProdPrice').value = product.price;
                document.getElementById('updateProdStock').value = product.stock_quantity;
                document.getElementById('updateProdActive').value = product.is_active.toString();
            }
        }

        async function updateProduct() {
            try {
                const prodId = document.getElementById('updateProdSelect').value;
                if (!prodId) {
                    alert('Please select a product');
                    return;
                }
                
                const data = await apiCall(`/products/${prodId}`, 'PUT', {
                    name: document.getElementById('updateProdName').value,
                    price: parseFloat(document.getElementById('updateProdPrice').value),
                    stock_quantity: parseInt(document.getElementById('updateProdStock').value),
                    is_active: document.getElementById('updateProdActive').value === 'true'
                }, true);
                showResponse('updateProductResponse', data);
                getProducts();
                loadProductDropdowns();
            } catch (error) {
                showResponse('updateProductResponse', error, true);
            }
        }

        async function deleteProduct() {
            const prodId = document.getElementById('deleteProdSelect').value;
            if (!prodId) {
                alert('Please select a product');
                return;
            }
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                const data = await apiCall(`/products/${prodId}`, 'DELETE', null, true);
                showResponse('deleteProductResponse', data);
                getProducts();
                loadProductDropdowns();
            } catch (error) {
                showResponse('deleteProductResponse', error, true);
            }
        }

        async function deleteProductById(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                const data = await apiCall(`/products/${id}`, 'DELETE', null, true);
                showResponse('productsResponse', data);
                getProducts();
                loadProductDropdowns();
            } catch (error) {
                showResponse('productsResponse', error, true);
            }
        }

        // Cart functions
        async function getCart() {
            try {
                const data = await apiCall('/cart', 'GET', null, true);
                showResponse('cartResponse', data);
                displayCart(data);
            } catch (error) {
                showResponse('cartResponse', error, true);
            }
        }

        async function addToCartFromSelect() {
            const productId = document.getElementById('cartProductSelect').value;
            if (!productId) {
                alert('Please select a product');
                return;
            }
            
            try {
                const data = await apiCall('/cart/items', 'POST', {
                    product_id: parseInt(productId),
                    quantity: parseInt(document.getElementById('cartQuantity').value) || 1
                }, true);
                showResponse('cartResponse', data);
                displayCart(data.cart);
            } catch (error) {
                showResponse('cartResponse', error, true);
            }
        }

        async function quickAddToCart(productId) {
            try {
                const data = await apiCall('/cart/items', 'POST', {
                    product_id: productId,
                    quantity: 1
                }, true);
                showResponse('productsResponse', { message: 'Added to cart!', cart: data.cart });
            } catch (error) {
                showResponse('productsResponse', error, true);
            }
        }

        async function updateCartItem() {
            try {
                const productId = document.getElementById('updateCartProductId').value;
                const quantity = document.getElementById('updateCartQuantity').value;
                
                const data = await apiCall(`/cart/items/${productId}`, 'PUT', {
                    quantity: parseInt(quantity)
                }, true);
                showResponse('cartResponse', data);
                displayCart(data.cart);
            } catch (error) {
                showResponse('cartResponse', error, true);
            }
        }

        async function removeFromCart(productId) {
            try {
                const data = await apiCall(`/cart/items/${productId}`, 'DELETE', null, true);
                showResponse('cartResponse', data);
                displayCart(data.cart);
            } catch (error) {
                showResponse('cartResponse', error, true);
            }
        }

        async function clearCart() {
            if (!confirm('Are you sure you want to clear your cart?')) return;
            
            try {
                const data = await apiCall('/cart/clear', 'POST', null, true);
                showResponse('cartResponse', data);
                document.getElementById('cartDetails').innerHTML = '<p>Cart is empty</p>';
            } catch (error) {
                showResponse('cartResponse', error, true);
            }
        }

        function displayCart(cart) {
            const details = document.getElementById('cartDetails');
            if (!cart || !cart.items || cart.items.length === 0) {
                details.innerHTML = '<p>Cart is empty</p>';
                return;
            }

            details.innerHTML = `
                <h3 style="margin-top: 20px;">Cart Items (${cart.total_items})</h3>
                <div class="items-grid">
                    ${cart.items.map(item => `
                        <div class="item-card">
                            <h4>${item.product.name}</h4>
                            <p><strong>Quantity:</strong> ${item.quantity}</p>
                            <p><strong>Unit Price:</strong> $${item.unit_price}</p>
                            <p class="price">Total: $${item.total_price}</p>
                            <div class="button-group">
                                <button onclick="document.getElementById('updateCartProductId').value=${item.product_id}; document.getElementById('updateCartQuantity').value=${item.quantity}" class="btn-warning">Edit</button>
                                <button onclick="removeFromCart(${item.product_id})" class="btn-danger">Remove</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; text-align: center;">
                    <h2>Cart Total: $${cart.subtotal}</h2>
                </div>
            `;
        }

        // Orders functions
        async function getOrders() {
            try {
                const data = await apiCall('/orders', 'GET', null, true);
                showResponse('ordersResponse', data);
                displayOrders(data.orders || [], 'ordersListContainer');
            } catch (error) {
                showResponse('ordersResponse', error, true);
            }
        }

        async function createOrder() {
            try {
                const data = await apiCall('/orders', 'POST', {
                    shipping_address: {
                        line1: document.getElementById('orderAddress1').value,
                        line2: document.getElementById('orderAddress2').value,
                        city: document.getElementById('orderCity').value,
                        state: document.getElementById('orderState').value,
                        postal_code: document.getElementById('orderPostal').value,
                        country: document.getElementById('orderCountry').value
                    },
                    payment_method: document.getElementById('orderPaymentMethod').value,
                    customer_notes: document.getElementById('orderNotes').value
                }, true);
                showResponse('ordersResponse', data);
                alert('Order created successfully!');
                getCart(); // Refresh cart (should be empty now)
            } catch (error) {
                showResponse('ordersResponse', error, true);
            }
        }

        async function getOrderDetails() {
            try {
                const orderId = document.getElementById('getOrderId').value;
                const data = await apiCall(`/orders/${orderId}`, 'GET', null, true);
                showResponse('ordersResponse', data);
                displayOrderDetails(data);
            } catch (error) {
                showResponse('ordersResponse', error, true);
            }
        }

        async function getAllOrders() {
            try {
                const status = document.getElementById('adminOrderStatus').value;
                let url = '/orders/admin';
                if (status) url += `?status=${status}`;
                
                const data = await apiCall(url, 'GET', null, true);
                showResponse('ordersResponse', data);
                displayOrders(data.orders || [], 'adminOrdersContainer');
            } catch (error) {
                showResponse('ordersResponse', error, true);
            }
        }

        async function updateOrderStatus() {
            try {
                const orderId = document.getElementById('updateOrderId').value;
                const status = document.getElementById('updateOrderStatus').value;
                
                const data = await apiCall(`/orders/${orderId}/status`, 'PUT', {
                    status: status
                }, true);
                showResponse('updateOrderResponse', data);
                getAllOrders();
            } catch (error) {
                showResponse('updateOrderResponse', error, true);
            }
        }

        async function updatePaymentStatus() {
            try {
                const orderId = document.getElementById('updatePaymentOrderId').value;
                const paymentStatus = document.getElementById('updatePaymentStatus').value;
                
                const data = await apiCall(`/orders/${orderId}/payment-status`, 'PUT', {
                    payment_status: paymentStatus
                }, true);
                showResponse('updatePaymentResponse', data);
                getAllOrders();
            } catch (error) {
                showResponse('updatePaymentResponse', error, true);
            }
        }

        function displayOrders(orders, containerId) {
            const container = document.getElementById(containerId);
            if (!orders || orders.length === 0) {
                container.innerHTML = '<p>No orders found</p>';
                return;
            }

            container.innerHTML = '<div class="items-grid">' + orders.map(o => `
                <div class="item-card">
                    <h4>Order #${o.order_number}</h4>
                    <p><strong>Status:</strong> <span class="badge">${o.status}</span></p>
                    <p><strong>Payment:</strong> <span class="badge">${o.payment_status}</span></p>
                    <p><strong>Total:</strong> <span class="price">$${o.total}</span></p>
                    <p><strong>Items:</strong> ${o.total_items}</p>
                    <p><strong>Date:</strong> ${new Date(o.created_at).toLocaleDateString()}</p>
                    ${o.customer ? `<p><strong>Customer:</strong> ${o.customer.full_name}</p>` : ''}
                    <div class="button-group">
                        <button onclick="document.getElementById('getOrderId').value=${o.id}; getOrderDetails()" class="btn-secondary">View Details</button>
                        ${currentUser?.role === 'admin' ? `
                            <button onclick="document.getElementById('updateOrderId').value=${o.id}" class="btn-warning">Update Status</button>
                        ` : ''}
                    </div>
                </div>
            `).join('') + '</div>';
        }

        function displayOrderDetails(order) {
            const container = document.getElementById('orderDetailsContainer');
            container.innerHTML = `
                <div class="section">
                    <h3>Order #${order.order_number}</h3>
                    <div class="form-row">
                        <p><strong>Status:</strong> <span class="badge">${order.status}</span></p>
                        <p><strong>Payment:</strong> <span class="badge">${order.payment_status}</span></p>
                    </div>
                    <div class="form-row">
                        <p><strong>Subtotal:</strong> $${order.subtotal}</p>
                        <p><strong>Tax:</strong> $${order.tax}</p>
                        <p><strong>Shipping:</strong> $${order.shipping_cost}</p>
                        <p><strong>Total:</strong> <span class="price">$${order.total}</span></p>
                    </div>
                    <h4>Shipping Address</h4>
                    <p>${order.shipping_address.line1}</p>
                    ${order.shipping_address.line2 ? `<p>${order.shipping_address.line2}</p>` : ''}
                    <p>${order.shipping_address.city}, ${order.shipping_address.state} ${order.shipping_address.postal_code}</p>
                    <p>${order.shipping_address.country}</p>
                    
                    ${order.customer_notes ? `<h4>Customer Notes</h4><p>${order.customer_notes}</p>` : ''}
                    
                    <h4>Order Items</h4>
                    <div class="items-grid">
                        ${order.items.map(item => `
                            <div class="item-card">
                                <h4>${item.product_name}</h4>
                                <p><strong>SKU:</strong> ${item.product_sku || 'N/A'}</p>
                                <p><strong>Quantity:</strong> ${item.quantity}</p>
                                <p><strong>Unit Price:</strong> $${item.unit_price}</p>
                                <p class="price">Total: $${item.total_price}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Initialize
        if (token) {
            try {
                currentUser = JSON.parse(localStorage.getItem('user'));
            } catch (e) {
                token = null;
                localStorage.removeItem('token');
            }
        }
        updateUserInfo();
        
        // Load initial data
        loadCategoryDropdowns();
        loadProductDropdowns();
    </script>
</body>
</html>